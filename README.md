# ã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ APIç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 

## æ¦‚è¦

ã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®å…¬å¼APIã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ»éšœå®³æƒ…å ±ã‚’ç›£è¦–ã—ã€Slackã«é€šçŸ¥ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## æ©Ÿèƒ½

### ðŸ” ç›£è¦–æ©Ÿèƒ½
- **APIãƒ™ãƒ¼ã‚¹ã®ç›£è¦–**: å…¬å¼API (`https://help.sakura.ad.jp/maint/api/v1/feeds/`) ã‚’ä½¿ç”¨
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œå‡º**: ä»Šæ—¥ä»¥é™ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ­£ç¢ºã«æ¤œå‡º
- **çµ‚äº†æ™‚é–“è€ƒæ…®**: éšœå®³ã¯ç¶™ç¶šä¸­ã¾ãŸã¯æœªæ¥ã®ã‚‚ã®ã®ã¿é€šçŸ¥

### ðŸ“¢ é€šçŸ¥ãƒ«ãƒ¼ãƒ«
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é€šçŸ¥**: æ¯Žæ—¥åˆå›žã®ã¿é€ä¿¡ã€åŒæ—¥å†…ã®é‡è¤‡ã¯é€ä¿¡ã—ãªã„
- **éšœå®³é€šçŸ¥**: ç¶™ç¶šä¸­ã¾ãŸã¯æœªæ¥ã®éšœå®³ã®ã¿é€šçŸ¥
- **URLæƒ…å ±ä»˜ã**: å„ã‚¤ãƒ™ãƒ³ãƒˆã®è©³ç´°ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ã‚’å«ã‚€

### ðŸŽ¯ ç›£è¦–å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹
- **ã•ãã‚‰ã®ãƒ¬ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒãƒ¼** (`rs`)
- **ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰** (`cloud`)
- **ã•ãã‚‰ã®IoT** (`iot`)
- **ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ»SSL** (`domainssl`)

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### GitHub Actionsã§ã®è‡ªå‹•å®Ÿè¡Œ

1. **GitHub Secretsã®è¨­å®š**
   - ãƒªãƒã‚¸ãƒˆãƒªã® Settings â†’ Secrets and variables â†’ Actions
   - `SLACK_WEBHOOK_URL` ã«å®Ÿéš›ã®Slack Webhook URLã‚’è¨­å®š

2. **å®Ÿè¡Œé »åº¦**
   - æ¯Žæ™‚0åˆ†ã«è‡ªå‹•å®Ÿè¡Œï¼ˆ1æ™‚é–“é–“éš”ï¼‰
   - æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

### ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ

#### å¿…è¦ãªç’°å¢ƒ
```bash
python >= 3.9
pip install -r requirements.txt
```

#### å®Ÿè¡Œæ–¹æ³•
```bash
# å¯¾è©±ãƒ¢ãƒ¼ãƒ‰
python sakura_checker.py

# è‡ªå‹•å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰
python sakura_checker.py auto

# ç’°å¢ƒå¤‰æ•°ã§ã®åˆ¶å¾¡
export AUTO_MODE=1
python sakura_checker.py
```

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
SAKURA_info/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ sakura-monitor.yml     # GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
â”œâ”€â”€ sakura_checker.py              # ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆAPIç‰ˆï¼‰
â”œâ”€â”€ find_services.py               # ã‚µãƒ¼ãƒ“ã‚¹åæ¤œç´¢ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ requirements.txt               # Pythonä¾å­˜é–¢ä¿‚
â”œâ”€â”€ notification_sent.json         # é€šçŸ¥å±¥æ­´ï¼ˆè‡ªå‹•ç”Ÿæˆãƒ»7æ—¥é–“ä¿æŒï¼‰
â””â”€â”€ README.md                      # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## é€šçŸ¥è©³ç´°

### ðŸŽ¨ Slacké€šçŸ¥å½¢å¼

**ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é€šçŸ¥ä¾‹:**
```
[ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰] ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æƒ…å ±ãŒã‚ã‚Šã¾ã™ï¼ˆ10ä»¶ï¼‰

ðŸ“‹ è©³ç´°æƒ…å ±:
1. [ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹] ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰ çŸ³ç‹©ç¬¬2ã‚¾ãƒ¼ãƒ³ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
2. [ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹] ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰(ã‚¦ã‚§ãƒ–ã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚¿)
... ä»–8ä»¶
```

**éšœå®³é€šçŸ¥ä¾‹:**
```
ðŸ”´ @here [ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰] éšœå®³æƒ…å ±ãŒã‚ã‚Šã¾ã™

ðŸ“‹ è©³ç´°æƒ…å ±:
1. [éšœå®³] ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰ çŸ³ç‹©ç¬¬2ã‚¾ãƒ¼ãƒ³ SSDãƒ—ãƒ©ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
```

### ðŸ“… é‡è¤‡åˆ¶å¾¡ä»•æ§˜

- **æ¯Žæ—¥ãƒªã‚»ãƒƒãƒˆ**: åˆå‰0æ™‚ï¼ˆJSTï¼‰ã«é‡è¤‡ãƒã‚§ãƒƒã‚¯ãŒãƒªã‚»ãƒƒãƒˆ
- **åˆå›žé€šçŸ¥**: ãã®æ—¥ã®æœ€åˆã®æ¤œå‡ºæ™‚ã«å…¨æƒ…å ±ã‚’é€šçŸ¥
- **é‡è¤‡ã‚¹ã‚­ãƒƒãƒ—**: åŒæ—¥å†…ã®åŒä¸€ã‚µãƒ¼ãƒ“ã‚¹ãƒ»ã‚¿ã‚¤ãƒ—ã¯é€šçŸ¥ã‚’ã‚¹ã‚­ãƒƒãƒ—
- **è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: 7æ—¥å‰ã‚ˆã‚Šå¤ã„å±¥æ­´ã‚’è‡ªå‹•å‰Šé™¤

## ç’°å¢ƒå¤‰æ•°

- `SLACK_WEBHOOK_URL`: Slack Webhook URL
- `AUTO_MODE`: è‡ªå‹•å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ãƒ•ãƒ©ã‚°ï¼ˆ'1'ã§æœ‰åŠ¹ï¼‰

## ãƒ­ã‚°

GitHub Actionsã®å®Ÿè¡Œãƒ­ã‚°ã¯ä»¥ä¸‹ã§ç¢ºèªã§ãã¾ã™ï¼š
- ãƒªãƒã‚¸ãƒˆãƒª â†’ Actions â†’ Sakura Internet Status Monitor

## APIä»•æ§˜

### ðŸ”Œ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **ãƒ™ãƒ¼ã‚¹URL**: `https://help.sakura.ad.jp/maint/api/v1/feeds/`
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
  - `service`: ã‚µãƒ¼ãƒ“ã‚¹è­˜åˆ¥å­ (`rs`, `cloud`, `iot`, `domainssl`)
  - `type`: ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ— (`maint`, `trouble`)
  - `ordering`: ã‚½ãƒ¼ãƒˆé † (`event_start`)
  - `limit`: å–å¾—ä»¶æ•° (æœ€å¤§100)

### ðŸ• æ™‚åˆ»å‡¦ç†
- **å…¥åŠ›å½¢å¼**: UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆç§’ï¼‰
- **è¡¨ç¤ºå½¢å¼**: JSTï¼ˆæ—¥æœ¬æ¨™æº–æ™‚ï¼‰
- **ãƒ•ã‚£ãƒ«ã‚¿åŸºæº–**: ä»Šæ—¥ï¼ˆJSTï¼‰ã®0:00ä»¥é™

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´

### v2.0.0ï¼ˆæœ€æ–°ï¼‰- APIç‰ˆ
- **é‡è¦**: HTMLè§£æžã‹ã‚‰APIåˆ©ç”¨ã«å®Œå…¨ç§»è¡Œ
- çµ‚äº†æ™‚é–“ã‚’è€ƒæ…®ã—ãŸéšœå®³ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- URLæƒ…å ±ä»˜ãSlacké€šçŸ¥
- æ¯Žæ—¥å˜ä½ã§ã®é‡è¤‡åˆ¶å¾¡
- è‡ªå‹•å±¥æ­´ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆ7æ—¥é–“ï¼‰

### v1.x - HTMLè§£æžç‰ˆï¼ˆå»ƒæ­¢ï¼‰
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒšãƒ¼ã‚¸ã®HTMLè§£æž
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰æ¤œå‡º

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **Slacké€šçŸ¥ãŒé€ä¿¡ã•ã‚Œãªã„**
   - `SLACK_WEBHOOK_URL`ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - GitHub Secretsã®è¨­å®šã‚’ç¢ºèª
   - Webhook URLã®æœ‰åŠ¹æœŸé™ã‚’ç¢ºèª

2. **é€šçŸ¥ã®é‡è¤‡/ã‚¹ã‚­ãƒƒãƒ—**
   - æ¯Žæ—¥0:00ï¼ˆJSTï¼‰ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ä»•æ§˜
   - `notification_sent.json`ã®å†…å®¹ã‚’ç¢ºèª
   - æ‰‹å‹•ãƒªã‚»ãƒƒãƒˆãŒå¿…è¦ãªå ´åˆã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤

3. **APIæŽ¥ç¶šã‚¨ãƒ©ãƒ¼**
   - ã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆAPI (`help.sakura.ad.jp`) ã¸ã®æŽ¥ç¶šã‚’ç¢ºèª
   - GitHub Actionsã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰APIã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã‹ç¢ºèª

4. **GitHub Actionså®Ÿè¡Œã‚¨ãƒ©ãƒ¼**
   - Actionsã‚¿ãƒ–ã§ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
   - Python 3.11ç’°å¢ƒã§ã®å‹•ä½œã‚’ç¢ºèª
   - ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (`requests`, `beautifulsoup4`) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«çŠ¶æ³ã‚’ç¢ºèª

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆé€šçŸ¥ãªã—ï¼‰
export SLACK_WEBHOOK_URL=dummy
echo "2" | python sakura_checker.py

# é€šçŸ¥å±¥æ­´ã®ç¢ºèª
cat notification_sent.json

# é€šçŸ¥å±¥æ­´ã®ãƒªã‚»ãƒƒãƒˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
echo '{}' > notification_sent.json
```